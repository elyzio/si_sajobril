{% extends "main/layout1.html" %}
{% load static %}
{% block head_link %}
<link rel="stylesheet" href="{% static 'notica/css/jquery.dataTables.min.css' %}">
{% endblock head_link %}

{% block contents %}
<section>
  <div class="container mt-5 border-0 p-3">
    <header>
      <ol class="breadcrumb mb-1 mt-1">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Varanda</a></li>
        <li class="breadcrumb-item"><a href="{% url 'list_transfers' %}">Transfer</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{title}}</li>
      </ol>
    </header>

    {% if messages %}
    {% for message in messages %}
    <div id="divmessage" class="alert alert-{{ message.tags }} alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      {{message}}
    </div>
    {% endfor %}
    {% endif %}

    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-header">
            <div class="row">
              <div class="col-lg-6">
                <h5 class="card-title">{{title}}</h5>
              </div>
              <div class="col-lg-6">
                <div class="float-right">
                  <!-- Year Filter -->
                  <select class="form-control form-control-sm" onchange="filterByYear(this.value)" style="width: 200px;">
                    <option value="">-- Hili Tinan --</option>
                    {% for ano in anos %}
                      <option value="{{ano.id}}" {% if current_ano.id == ano.id %}selected{% endif %}>{{ano.ano}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card-body">
            <div class="alert alert-warning">
              <i class="fa fa-info-circle"></i> Lista estudante sira ne'ebÃ© transfer ona ba eskola seluk iha tinan {{current_ano.ano}}.
            </div>

            <div class="table-responsive">
              <table class="table table-striped table-bordered" id="dataTable">
                <thead class="bg-danger text-white">
                  <tr>
                    <th>#</th>
                    <th>Naran Estudante</th>
                    <th>EMIS</th>
                    <th>Turma Before</th>
                    <th>Ba Eskola</th>
                    <th>Data Transfer</th>
                    <th>Razaun</th>
                    <th>Aprova husi</th>
                  </tr>
                </thead>
                <tbody>
                  {% for transfer in transferred_students %}
                  <tr>
                    <td>{{forloop.counter}}</td>
                    <td>{{transfer.estudante.naran}}</td>
                    <td>{{transfer.estudante.emis}}</td>
                    <td>{{transfer.from_turma|default:"-"}}</td>
                    <td>{{transfer.to_school|default:"-"}}</td>
                    <td>{{transfer.transfer_date|date:"d/m/Y"}}</td>
                    <td>{{transfer.reason|truncatechars:50|default:"-"}}</td>
                    <td>
                      {{transfer.approved_by.username}}<br>
                      <small class="text-muted">{{transfer.approval_date|date:"d/m/Y H:i"}}</small>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="8" class="text-center">Seidauk iha estudante transfer out iha tinan ne'e</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="{% static 'notica/js/jquery.min.js' %}"></script>
<script src="{% static 'notica/js/data-table/jquery.dataTables.min.js' %}"></script>
<script>
  $(document).ready(function() {
    $('#dataTable').DataTable({
      "language": {
        "url": "//cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese.json"
      }
    });
  });
  
  function filterByYear(yearId) {
    if (yearId) {
      window.location.href = "{% url 'transferred_out_students' 0 %}".replace('0', yearId);
    } else {
      window.location.href = "{% url 'transferred_out_students_all' %}";
    }
  }
</script>
{% endblock contents %}